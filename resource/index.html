<html>
<head>
  <title>Piping</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    h3 {
      margin-top: 2em;
      margin-bottom: 0.5em;
    }
  </style>
</head>
<body>
<h1>Piping</h1>
Streaming Data Transfer Server over HTTP/HTTPS
<h3>Step 1: Choose a file or text</h3>

<input type="checkbox" id="text_mode" onchange="toggleInputMode()">: <b>Text mode</b><br><br>

<input type="file" id="file_input">
<textarea type="text" id="text_input" placeholder="Input text" cols="30" rows="10"></textarea>
<br>

<h3>Step 2: Write your secret path</h3>
(e.g. "abcd1234", "mysecret.png")<br>
<input id="secret_path" placeholder="Secret path" size="50"><br>
<h3>Step 3: Click the send button</h3>
<button onclick="send()">Send</button><br>
<progress id="progress_bar" value="0" max="100" style="display: none">0%</progress>
<hr>
GitHub repository:
<a href="https://github.com/nwtgck/piping-server-rust#readme">
  https://github.com/nwtgck/piping-server-rust#readme
</a><br>
<script>
  // Toggle input mode: file or text
  var toggleInputMode = (function () {
    var activeInput      = window.file_input;
    var deactivatedInput = window.text_input;

    // Set inputs' functionality and visibility
    function setInputs() {
      activeInput.removeAttribute("disabled");
      activeInput.style.removeProperty("display");

      deactivatedInput.setAttribute("disabled", "");
      deactivatedInput.style.display = "none";
    }
    setInputs();

    // Body of toggleInputMode
    function toggle() {
      // Swap inputs
      console.log(window.text_mode.checked);
      var tmpInput     = activeInput;
      activeInput      = deactivatedInput;
      deactivatedInput = tmpInput;
      setInputs();
    }
    return toggle;
  })();

  function setProgress(progress) {
    window.progress_bar.value = progress;
    window.progress_bar.innerText = progress + "%";
  }

  function send() {
    // Select body (text or file)
    var body = window.text_mode.checked ? window.text_input.value : window.file_input.files[0];
    // Send
    var xhr = new XMLHttpRequest();
    xhr.open('POST', "/" + window.secret_path.value, true);
    // Update progress bar
    xhr.upload.onprogress = function (ev) {
      var progress = ev.loaded / ev.total * 100;
      setProgress(progress);
    };
    xhr.onreadystatechange = function() {
      // Send finished
      if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
        setProgress(100);
      }
    };
    xhr.send(body);
    // Show progress bar
    window.progress_bar.style.display = null;
  }
</script>
</body>
</html>
